{% extends "repairs/base.html" %}


{% block content %}
<div class="container mt-5">
    <h1>{{ apartment.name }}</h1>
    <span>Адрес: {{ apartment.address }}</span>
    <span>Площадь: {{ apartment.total_area }} м²</span>
    <span>Бюджет на работы: {{ apartment.works_cost|floatformat:2 }} руб.</span>
    <span>Бюджет на материалы: {{ apartment.materials_cost|floatformat:2 }} руб.</span>
    <span>Общий бюджет: {{ apartment.total_cost|floatformat:2 }} руб.</span>
    <a href="{% url 'room_create' apartment.id %}" class="btn btn-primary mb-3">Добавить комнату</a>
    <h3>Комнаты:</h3>
    <ul class="list-group mb-4">
        {% for room in rooms %}
        <li class="list-group-item">{{ room.name }} — (Площадь: {{ room.area }} м²)
            <a href="{% url 'work_create' room.id %}" class="btn btn-sm btn-primary ms-2">Добавить работу</a>
             <a href="{% url 'material_create' room.id %}" class="btn btn-sm btn-primary ms-2">Добавить материал</a>
            {% if room.work_set.all %}
            <h5 class="mt-3">Работы</h5>
            <table class="table">
                <thead>
                <tr>
                    <th>Название</th>
                    <th>Описание</th>
                    <th>Стоимость</th>
                    <th>Дата</th>
                    <th>Действия</th>
                </tr>
                </thead>
                <tbody>
                {% for work in room.work_set.all %}
                <tr>
                    <td>{{ work.name }}</td>
                    <td>{{ work.description|default:"—" }}</td>
                    <td>{{ work.cost }}</td>
                    <td>{{ work.date }}</td>
                    <td>
                        <a href="{% url 'work_edit' work.id %}" class="btn btn-sm btn-warning">Редактировать</a>
                        <a href="{% url 'work_delete' work.id %}" class="btn btn-sm btn-danger">Удалить</a>
                    </td>
                </tr>
                {% endfor %}
                </tbody>
            </table>
            {% endif %}
         {% if room.material_set.all %}
                        <h5 class="mt-3">Материалы</h5>
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Название</th>
                                    <th>Количество</th>
                                    <th>Единица</th>
                                    <th>Стоимость</th>
                                    <th>Действия</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for material in room.material_set.all %}
                                    <tr>
                                        <td>{{ material.name }}</td>
                                        <td>{{ material.quantity }}</td>
                                        <td>{{ material.unit }}</td>
                                        <td>{{ material.cost }}</td>
                                        <td>
                                            <a href="{% url 'material_edit' material.id %}" class="btn btn-sm btn-warning">Редактировать</a>
                                            <a href="{% url 'material_delete' material.id %}" class="btn btn-sm btn-danger">Удалить</a>
                                        </td>
                                    </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    {% endif %}
                </li>
        {% empty %}
        <li class="list-group-item">Нет комнат</li>
        {% endfor %}
    </ul>
    <a href="{% url 'apartment' %}" class="btn btn-secondary mt-3">Назад</a>
</div>
{% endblock %}

